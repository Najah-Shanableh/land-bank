<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBroCTXbMjlkQTtTjuICn2sMKtM7IssVp0&sensor=false"></script>
<script type="text/javascript" src="/static/landbank_data/wax/dist/wax.g.js"></script>
<link href="/static/landbank_data/wax/theme/controls.css" rel="stylesheet" type="text/css" />
<script type="text/javascript">
function initialize() {
  var mapOptions = {
    zoom: 14,
    center: new google.maps.LatLng({{mapcenter.lat}}, {{mapcenter.lon}}),
    mapTypeControl: false,
    mapTypeId: google.maps.MapTypeId.ROADMAP
  };
  var bounds = new google.maps.LatLngBounds();
  var map = new google.maps.Map(document.getElementById("map-aggregate"),
      mapOptions);
  var polygonCoords = [
    {% with outline.0.0 as the_polygon %}
        {% for point in the_polygon %}
          new google.maps.LatLng({{ point.1 }}, {{ point.0 }}),
        {% endfor %}
      {% endwith %}
    ];
    var the_polygon = new google.maps.Polygon({
      paths: polygonCoords,
      strokeColor: "#0000FF",
      strokeOpacity: 0.8,
      strokeWeight: 2,
      fillColor: "#000077",
      fillOpacity: 0.35
    });

    for (i=0; i<polygonCoords.length; i++) {
      bounds.extend(polygonCoords[i]);
    }

    the_polygon.setMap(map);

  var transitLayer = new google.maps.TransitLayer();
  transitLayer.setMap(map); 

  // Composited raster layer of parcel outline and shaded foreclosure
  var base_foreclosure_url = 'http://api.tiles.mapbox.com/v3/salice412.parcel,salice412.parcel_foreclosure.jsonp';
  wax.tilejson(base_foreclosure_url,
    function(tilejson) {
      map.overlayMapTypes.insertAt(0, new wax.g.connector(tilejson));
    });

  map.fitBounds(bounds);
  // Position map area label
  google.maps.event.addListenerOnce(map, 'idle', function() {
    $('#map-aggregate')[0].childNodes[0].appendChild($('.wax-tooltip')[0]);
    $('.wax-tooltip').show()[0];
  });
}
google.maps.event.addDomListener(window, 'load', initialize);

</script>
